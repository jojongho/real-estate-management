# 정규화 시트 구조 분석

**시트 ID**: `1OQyBAJCxdWM1txdfBOXMNxSaGGlF0veafU_Kkp06PWM`

---

## 📊 시트별 구조

### 1. 분양가 시트

**컬럼 구조**:
```
A: 단지명 (예: e편한세상성성호수공원)
B: 동 (예: 102, 103, 108...)
C: 호 (예: 3, 4, 1...)
D: 타입 (예: 84A)
E: 최저층 (예: 2)
F: 최고층 (예: 2)
G: 분양가 (예: 497800000)
```

**데이터 샘플**:
```
e편한세상성성호수공원, 102, 3, 84A, 2, 2, 497800000
e편한세상성성호수공원, 103, 3, 84A, 2, 2, 497800000
e편한세상성성호수공원, 103, 4, 84A, 2, 2, 497800000
...
```

**특징**:
- ✅ 동/호/층별로 세분화된 정확한 분양가
- ✅ 층 범위 표현 (최저층~최고층)
- ✅ 깔끔한 정규화 구조

---

### 2. 단지일정 시트

**컬럼 구조**:
```
A: 단지명
B: 일정명 (예: 입주자모집공고, 특별공급, 1순위, 서류접수...)
C: 시작일 (예: 2025. 2. 20)
D: 종료일 (예: 2025. 3. 21)
```

**데이터 샘플**:
```
e편한세상성성호수공원, 입주자모집공고, 2025. 2. 20, (종료일 없음)
e편한세상성성호수공원, 특별공급, 2025. 3. 4, (종료일 없음)
e편한세상성성호수공원, 1순위, 2025. 3. 5, (종료일 없음)
e편한세상성성호수공원, 서류접수, 2025. 3. 14, 2025. 3. 21
...
```

**특징**:
- ✅ 모든 일정이 개별 행으로 분리
- ✅ 날짜 형식: `YYYY. M. D.`
- ✅ 중도금, 잔금 일정까지 상세 기록

---

### 3. 타입 시트 (주택형 정보)

**컬럼 구조** (매우 상세함):
```
A: 단지명
B: 주택 공급면적
C: 모델
D: 주택형 (공급면적)
E: 세대타입
F: 주거 전용면적
G: 주거공용면적
H: 소계 (공급면적)
I: 공급세대 (지하포함)
J: 계약 면적
K: 세대별 대지지분
L: 총공급 세대수
M: 세대별 용도지역
N: ... (기관추천, 다자녀 가구 등 특별공급 배정)
O: ... (생애최초, 신혼부부 등)
P: 일반공급 세대수
Q: 임금 수탁현 세대
...
```

**데이터 샘플**:
```
e편한세상성성호수공원, 2025000036, 1, 084.9752A, 84A, 84.9752, 28.5592, ...
e편한세상성성호수공원, 2025000036, 2, 084.9748B, 84B, 84.9748, 28.5831, ...
...
당첨징원이마발파크, 2025000401, 1, 084.9767B, 84B, 84.9767, 26.3518, ...
```

**특징**:
- ✅ 면적, 세대수, 특별공급 배정 등 매우 상세
- ✅ 복수 단지 데이터 포함
- ✅ 공급 관련 모든 정보 집약

---

### 4. 발코니 시트

**컬럼 구조**:
```
A: 단지명
B: 약칭 표기
C: 타입
D: 품목
E: 품목세부
F: 설치내역
G: 공급금액
... (추가 컬럼들)
```

**데이터 샘플**:
```
e편한세상성성호수공원, 84A, (품목), (세부), (내역), 14500000
e편한세상성성호수공원, 84B, (품목), (세부), (내역), 14500000
e편한세상성성호수공원, 84C, (품목), (세부), (내역), 13500000
...
```

**특징**:
- ✅ 타입별 발코니 확장비
- ✅ 계약금, 중도금, 잔금 납부 일정 포함
- ✅ 단지별/타입별 금액 구분

---

### 5. 옵션 시트

**컬럼 구조**:
```
A: 단지명
B: 옵션구분 (예: 천장형 시스템 에어컨)
C: 타입
D: 품목
E: 품목세부
F: 설치내역 (매우 상세)
G: 공급금액
... (Option-merge 등 추가 정보)
```

**데이터 샘플**:
```
보현세상성성호수공원, 천장형 시스템 에어컨, 84A, 개별선택, 2대, 거실+침실1, 3,500,000
보현세상성성호수공원, 천장형 시스템 에어컨, 84A, 개별선택, 4대, 거실+침실1+침실2+침실3, 6,500,000
보현세상성성호수공원, 천장형 시스템 에어컨, 84B, 개별선택, 2대, 거실+침실1, 3,500,000
...
보현세상성성호수공원, STYLE 내추럴 톤, 84A, STYLE선택 기본 톤목, (상세 내역), 10,700,000
```

**특징**:
- ✅ 옵션 종류별 상세 구분 (시스템에어컨, STYLE 등)
- ✅ 타입별/선택지별 개별 행
- ✅ 설치 내역 매우 상세 (어느 방에 몇 대 등)
- ✅ 복합 옵션 정보 포함 (Option-merge 컬럼)

---

## 🔗 매물관리 시트 연동 전략

### 매핑 전략

#### 1. 분양가 자동 입력
**조건**: 단지명 + 동 + 호 + 층
```excel
=IFERROR(
  INDEX(
    IMPORTRANGE("1OQyBAJCxdWM1txdfBOXMNxSaGGlF0veafU_Kkp06PWM", "분양가!G:G"),
    MATCH(
      1,
      (IMPORTRANGE("1OQyBAJCxdWM1txdfBOXMNxSaGGlF0veafU_Kkp06PWM", "분양가!A:A")=C4) *
      (IMPORTRANGE("1OQyBAJCxdWM1txdfBOXMNxSaGGlF0veafU_Kkp06PWM", "분양가!B:B")=C5) *
      (IMPORTRANGE("1OQyBAJCxdWM1txdfBOXMNxSaGGlF0veafU_Kkp06PWM", "분양가!C:C")=C6),
      0
    )
  ),
  ""
)
```

**문제점**:
- ❌ IMPORTRANGE를 여러 번 호출 → 느림
- ❌ 층 정보 누락 시 부정확

**개선 방안**:
- ✅ 별도 시트에 IMPORTRANGE 한 번만 사용
- ✅ 층 정보도 조건에 포함

#### 2. 타입 자동 입력
**조건**: 단지명 + 동 + 호
```excel
=IFERROR(
  INDEX(분양가임포트!D:D,
    MATCH(C4&C5&C6, 분양가임포트!A:A&분양가임포트!B:B&분양가임포트!C:C, 0)
  ),
  ""
)
```

#### 3. 발코니 확장비 자동 입력
**조건**: 단지명 + 타입
```excel
=IFERROR(
  VLOOKUP(
    C4&C7,
    {발코니임포트!A:A&발코니임포트!C:C, 발코니임포트!G:G},
    2,
    FALSE
  ),
  ""
)
```

#### 4. 옵션 선택 리스트 생성
**조건**: 단지명 + 타입
```javascript
// Apps Script로 구현
function loadOptions() {
  const apartmentName = regSheet.getRange('C4').getValue();
  const type = regSheet.getRange('C7').getValue();

  // 옵션 시트에서 해당 단지+타입의 모든 옵션 가져오기
  const options = optionSheet.getDataRange().getValues()
    .filter(row => row[0] === apartmentName && row[2] === type);

  // 드롭다운이나 체크박스로 표시
  // ...
}
```

---

## 📋 구현 우선순위

### Phase 1: 기본 연동 (IMPORTRANGE)
1. ✅ 분양가임포트 시트 생성
2. ✅ 발코니임포트 시트 생성
3. ✅ 기본 VLOOKUP 수식 작성

### Phase 2: 고급 자동화 (Apps Script)
1. ✅ 동/호 입력 시 자동 실행
2. ✅ 옵션 리스트 동적 생성
3. ✅ 층 정보 자동 판별

### Phase 3: n8n 통합
1. ✅ 신규 매물 등록 시 검증
2. ✅ 정규화 데이터 업데이트 감지
3. ✅ 자동 알림 발송

---

## 🎯 다음 단계

**즉시 구현 가능한 것들**:
1. IMPORTRANGE로 분양가/발코니 데이터 가져오기
2. 등록검색 시트에 자동 조회 수식 추가
3. Apps Script로 타입 자동 입력

**선택하세요:**
1. IMPORTRANGE 수식부터 구현 (가장 빠름)
2. Apps Script 전체 자동화 구현
3. n8n 워크플로우 설계

어떤 걸로 시작할까요? 🚀
