# Ref 컬럼 Valid_If 올바른 수식 🔧

**문제**: `IN([단지명].[단지명], ["A", "B"])` 에러 발생

**원인**: Ref 타입 컬럼의 Valid_If 수식이 잘못됨

---

## 🎯 올바른 해결책 2가지

### 방법 1: 아파트단지 ID 사용 (추천) ⭐⭐⭐⭐⭐

**아파트단지 테이블을 확인해야 함**

먼저 이 단지들의 ID를 알아야 합니다:
```
□ Data → Tables → 아파트단지
□ 단지명과 ID 확인
```

**예시**:
```
ID | 단지명
1  | 아산배방1단지우방아이유쉘
2  | 아산배방우방아이유쉘2단지
3  | 힐스테이트두정역
...
```

**Valid_If 수식**:
```
IN([단지명].[ID], [1, 2])
```

또는:
```
OR(
  [단지명].[ID] = 1,
  [단지명].[ID] = 2
)
```

---

### 방법 2: 단지명 문자열로 비교 (대안)

**Valid_If 수식**:
```
OR(
  CONTAINS([단지명], "아산배방1단지우방아이유쉘"),
  CONTAINS([단지명], "아산배방우방아이유쉘2단지")
)
```

또는:
```
IN(SELECT(아파트단지[단지명]), ["아산배방1단지우방아이유쉘", "아산배방우방아이유쉘2단지"])
```

⚠️ **주의**: 이 방법은 AppSheet 버전에 따라 작동하지 않을 수 있음

---

## 🎯 가장 확실한 방법: 테이블 구조 확인 후

### Step 1: 아파트단지 테이블 확인

```
□ AppSheet → Data → Tables → 아파트단지
□ 컬럼 구조 확인:
   - ID (Key)
   - 단지명 (Label)
```

### Step 2: 해당 단지 ID 찾기

```
□ 아파트단지 테이블의 데이터 확인
□ "아산배방1단지우방아이유쉘"의 ID = ?
□ "아산배방우방아이유쉘2단지"의 ID = ?
```

### Step 3: Valid_If 수식 입력

**ID가 123, 456이라면**:
```
IN([단지명].[ID], [123, 456])
```

---

## 💡 임시 해결책: 아파트단지 Slice 사용

**단지명 테이블 자체를 필터링**:

```
1. Data → Slices → + New Slice

2. Slice name: 배방아이유쉘_단지전용

3. Detail table: 아파트단지

4. Condition:
   OR(
     [단지명] = "아산배방1단지우방아이유쉘",
     [단지명] = "아산배방우방아이유쉘2단지"
   )

5. Save

6. Data → Tables → 아파트단지
   Source slice: 배방아이유쉘_단지전용 변경

⚠️ 주의: 이렇게 하면 다른 폼에도 영향!
```

---

## 🚨 왜 에러가 발생했나?

**잘못된 수식**:
```
IN([단지명].[단지명], ["아산배방1단지우방아이유쉘", "아산배방우방아이유쉘2단지"])
```

**문제점**:
- `[단지명]`이 Ref 타입
- `[단지명].[단지명]`은 디레퍼런스
- IN() 함수에서 리스트 비교 시 컬럼 참조로 인식됨

**해결**:
- ID 값으로 비교
- 또는 SELECT()로 먼저 필터링 후 비교

---

## ✅ 최종 추천

**가장 확실하고 안전한 방법**:

```
1. 아파트단지 테이블에서 해당 단지 ID 확인
2. Valid_If:
   IN([단지명].[ID], [여기에_ID_값들])
```

**예시** (ID가 10, 20이면):
```
IN([단지명].[ID], [10, 20])
```

---

**이 방법이 가장 확실합니다!** ✅






