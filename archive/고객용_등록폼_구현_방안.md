# 고객용 매물 등록 폼 구현 방안

**작성일**: 2025-01-XX
**목적**: 고객이 직접 매물 정보를 입력할 수 있는 동적 폼 제공

---

## 📋 요구사항 분석

### 현재 등록검색 시트 기능
- **매물 기본정보**: 단지명, 동, 호, 타입, 거래유형, 거래상태, 분양가 등
- **고객 정보**: 고객구분, 유입경로, 연락처, 비상연락처, 고객성함, 고객주소
- **동적 로딩**: 단지명 선택 → 분양가 자동 로딩 (IMPORTRANGE)
- **옵션 선택**: 타입 선택 → 옵션 리스트 동적 필터링 (외부 DB 연동)
- **ID 자동 생성**: 매물ID, 고객ID (수식 기반)

### 고객에게 필요한 기능
1. ✅ **간단한 입력 인터페이스** - 복잡한 시트 대신 폼 형태
2. ✅ **단계별 입력** - 매물 정보 → 고객 정보 → 확인
3. ✅ **자동 데이터 검증** - 유효성 체크
4. ✅ **외부 접근성** - 링크만으로 접근 가능
5. ✅ **데이터 자동 저장** - 매물DB + 고객DB 자동 등록

---

## 🎯 3가지 구현 방안 비교

| 항목 | 구글 폼 | Apps Script 웹앱 | AppSheet |
|------|---------|------------------|----------|
| **복잡도** | ⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ |
| **동적 기능** | ❌ 제한적 | ✅ 완전 제어 | ✅ 제공 |
| **DB 연동** | ❌ 어려움 | ✅ 완벽 | ✅ 완벽 |
| **외부 공개** | ✅ 쉬움 | ⚠️ 권한 설정 필요 | ✅ 쉬움 |
| **유지보수** | ⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐⭐ |
| **비용** | 무료 | 무료 | 무료 (제한있음) |
| **추천도** | ❌ | ⭐⭐⭐ | ⭐⭐⭐⭐⭐ |

---

## ✅ 방안 1: AppSheet (최고 추천) ⭐⭐⭐⭐⭐

### 장점
- ✅ **완벽한 동적 폼**: 조건부 필드, 타입별 다른 옵션, 단계별 입력 지원
- ✅ **자동 DB 연동**: 현재 구글시트와 직접 연동
- ✅ **모바일 최적화**: 앱 형태로 제공 가능
- ✅ **고급 기능**: 사진 업로드, GPS 위치, PDF 생성 가능
- ✅ **보안**: 권한 설정, 제출 후 확인 메일 발송

### 단점
- ⚠️ 초기 학습 곡선 있음 (약 1-2일 소요)
- ⚠️ 현재 Apps Script 로직을 AppSheet 앱 표현식으로 재작성 필요

### 구현 단계

#### 1단계: AppSheet 앱 생성
```
1. AppSheet 설치 (구글 워크스페이스)
2. 현재 스프레드시트 선택: 1tkDKc7RTCLRgYPM-6e3CFEBOsHckLlNmddfKlVUX2rQ
3. 자동 테이블 스캔: 매물DB, 고객DB, 아파트단지 등
```

#### 2단계: 고객용 폼 뷰 생성
```
Views → New View → Form
- 테이블: 매물DB
- 모드: ADD_ONLY (추가만 허용)
- 필드 구성:
  1. 매물 정보 섹션
     - 단지명 (Dropdown: 아파트단지 테이블 참조)
     - 동 (Number)
     - 호 (Number)
     - 타입 (Dropdown: 선택된 단지명의 타입 목록)
     - 거래유형 (Enum: 매매/전세/월세)
     - 거래상태 (Enum: 접수/진행중/완료)
  
  2. 가격 정보 섹션 (동적 표시)
     - 분양가 (Virtual: LOOKUP 동적 조회)
     - 발코니 (Virtual)
     - 옵션 (Checkbox list: 타입별 필터링)
     - 매매가/전세가/보증금/월세
  
  3. 고객 정보 섹션
     - 고객구분 (Enum: 매도인/손님)
     - 고객성함 (Text)
     - 연락처 (Phone)
     - 비상연락처 (Phone)
     - 고객주소 (Text)
     - 유입경로 (Enum: 광고/소개/온라인 등)
     - 메모 (Long Text)
```

#### 3단계: 동적 로직 구현
```javascript
// 가격 자동 조회 (Virtual Column)
분양가 = LOOKUP(
  CONCATENATE([단지명], "-", [동], "-", [호]),
  "분양가_매핑",
  "단지명-동-호",
  "분양가"
)

// 옵션 필터링 (Slice)
옵션리스트 = Slice "옵션데이터"
- 조건: [단지명] = [_THISROW].[단지명] 
        AND [타입] = [_THISROW].[타입] 
        AND [옵션구분] ≠ "발코니확장"

// ID 자동 생성 (실행 시 계산)
매물ID = CONCATENATE([단지명_축약], " ", [동], "-", [호], "-", [타입])
고객ID = CONCATENATE([단지명_축약], " ", [동], "-", [호], " O")

// 옵션 합계 계산
옵션비 = SUM(SELECT([선택된옵션].[금액], [선택여부] = TRUE))
```

#### 4단계: 고급 기능 추가
```
1. 사진 업로드
   - 컬럼 타입: IMAGE
   - 자동 Google Drive 저장

2. 제출 알림
   - Automation: ADD_ONLY → Send Email
   - 고객/담당자에게 자동 메일

3. 승인 워크플로우
   - 거래상태: "접수" (기본) → 담당자 확인 후 "진행중" 변경
   - 조회용 Dashboard 뷰 생성

4. 공개 링크 설정
   - Settings → Access → Public Form Link 생성
   - 인증 없이 제출만 가능 (읽기/수정 불가)
```

### 예상 소요 시간
- **초기 설정**: 4-6시간
- **동적 로직 구현**: 2-3시간
- **테스트 및 디버깅**: 2시간
- **총 예상**: 1-2일

---

## ✅ 방안 2: Google Apps Script 웹앱 ⭐⭐⭐

### 장점
- ✅ **현재 시스템 100% 재사용**: 기존 Apps Script 로직 활용
- ✅ **완전 제어**: 모든 기능 커스터마이징 가능
- ✅ **무료**: 추가 비용 없음

### 단점
- ❌ **UI 개발 필요**: HTML/CSS/JavaScript 직접 작성
- ❌ **외부 접근 설정**: 권한 관리 복잡
- ❌ **유지보수**: 코드 관리 부담

### 구현 개요
```
현재 Apps Script에 웹앱 배포 기능 추가:

1. HTML 서비스로 폼 UI 생성
   - Google Material Design 적용
   - 단계별 폼 (Wizard)
   
2. 기존 registerPropertyAndClient() 함수 활용
   - doPost() 엔드포인트로 폼 데이터 수신
   
3. 권한 설정
   - "누구나 액세스 가능" 또는 "도메인 내 사용자"
   
4. 외부 링크 생성
   - apps-script.google.com/a/사용자스크립트id
```

---

## ❌ 방안 3: Google Forms ⭐⭐

### 문제점

#### 1. 동적 데이터 로딩 불가
현재 시스템의 핵심 기능:
```
단지명 선택 → 분양가 자동 표시 (IMPORTRANGE 기반)
타입 선택 → 해당 타입의 옵션만 표시 (필터링)
```
**→ 구글 폼은 외부 DB 조회 불가**

#### 2. 복잡한 선택 UI 불가
```
등록검색 시트의 E5:H 옵션 리스트:
- 체크박스 (E열)
- 옵션구분 (F열, 같은 값 병합)
- 내역 (G열, 긴 텍스트)
- 금액 (H열, 천단위 표시)
```
**→ 구글 폼의 체크박스는 텍스트만, 병합/스타일링 불가**

#### 3. 워크플로우 부재
```
필요한 기능:
- 매물 정보 입력 → 매물DB 저장
- 고객 정보 입력 → 고객DB 저장  
- 자동 ID 생성 및 연결
- 폴더 자동 생성 (Google Drive)
```
**→ 구글 폼은 단순 응답만 수집, 복잡한 로직 불가**

### 대안 제시
구글 폼은 **최종 단계에서만** 사용 가능:
1. 간단한 고객 문의만 받고 싶다
2. 복잡한 검증/연동 불필요
3. 임시 수집용

---

## 📊 최종 권장사항

### 🥇 1순위: **AppSheet 전환**
**이유**:
- 현재 구글시트 기반 → AppSheet가 가장 적합
- 모바일 지원으로 고객 편의성 ↑
- 유지보수 용이, 확장성 좋음
- Phase 1 목표 (데이터 품질 95%) 달성 후 Phase 2로 진행 권장

**시작 방법**:
```bash
# AppSheet 로그인
https://appsheet.com

# 구글 계정 연동
# 현재 스프레드시트 선택

# 자동 테이블 인식 후 뷰 커스터마이징
```

### 🥈 2순위: **Apps Script 웹앱**
**이유**:
- 빠른 구현 필요 시
- 기존 코드 100% 재사용
- 완전한 제어 필요 시

### 🥉 3순위: **구글 폼은 추천 안함**
**이유**:
- 핵심 기능(동적 로딩, DB 연동) 불가

---

## 🎯 다음 단계

### AppSheet로 진행 시
1. AppSheet 앱 생성 및 기본 설정 (1일)
2. 테이블 연동 테스트 (0.5일)
3. 고객용 폼 뷰 구현 (1일)
4. 동적 로직 추가 (1일)
5. 테스트 및 배포 (0.5일)

**총 예상**: 3-4일 소요

### Apps Script 웹앱으로 진행 시
1. HTML 폼 UI 작성 (2일)
2. 기존 Apps Script 엔드포인트 연결 (1일)
3. 권한 설정 및 배포 (0.5일)
4. 테스트 (0.5일)

**총 예상**: 4일 소요

---

## 💡 추가 고려사항

### 보안
- 고객 개인정보 보호
- 제출 데이터 암호화
- 접근 권한 관리

### 알림 시스템
- 제출 성공 메일
- 담당자 알림
- SMS 연동 (선택)

### 분석
- 제출 통계 (AppSheet Analytics)
- 고객 이탈률 추적
- 폼 완료율 모니터링

---

**질문이 있으시면 언제든 말씀해주세요!** 🚀

