# 구글 앱스 스크립트(GAS) 건축물대장 자동화 가이드

Vworld API의 불안정한 연결(502 Bad Gateway) 문제를 해결하기 위해, n8n 대신 **Google Apps Script**를 사용하여 구글 서버 내부에서 직접 API를 호출하는 방법입니다.

## 1. 스크립트 파일 준비

프로젝트 폴더 내에 코드가 이미 준비되어 있습니다:
`/Users/jojongho/project/real-estate-management/apps-script/BuildingLedger.gs`

## 2. 구글 시트 설정

1.  **구글 시트 열기**: 자동화를 적용할 스프레드시트를 엽니다.
2.  **헤더 확인**: 첫 번째 행에 다음 컬럼명이 반드시 있어야 합니다. (순서는 상관없으나 정확한 이름이어야 합니다)
    *   `주소` (필수 입력값)
    *   `도로명주소`
    *   `대지면적`
    *   `건축면적`
    *   `건폐율`
    *   `연면적`
    *   `용적률`
    *   `구조코드명`
    *   `사용승인일`
    *   `용적률산정연면적`
    *   `내진설계여부`
    *   `내진능력`
    *   `일반건물여부`

## 3. 스크립트 적용

1.  상단 메뉴의 **확장 프로그램** > **Apps Script**를 클릭합니다.
2.  편집기 화면이 열리면 왼쪽 파일 목록 옆의 `+`를 눌러 **스크립트**를 선택합니다.
3.  이름을 `BuildingLedger`로 지정합니다.
4.  편집기 내용을 지우고, 준비된 `BuildingLedger.gs` 파일의 내용을 **전체 복사해서 붙여넣습니다**.
5.  코드 최상단의 **API KEY 설정** 부분을 찾아 본인의 키를 입력합니다.
    ```javascript
    const VWORLD_API_KEY = "본인의_VWORLD_키";
    const DATA_GO_KR_KEY = "본인의_공공데이터포털_서비스키";
    ```
6.  `Ctrl + S` (맥은 `Cmd + S`)를 눌러 저장합니다.

## 4. 실행 방법

1.  스크립트를 저장하고 구글 시트로 돌아와 **새로고침(F5)**을 합니다.
2.  약 5~10초 후 상단 메뉴바 오른쪽 끝에 **'건축물대장'** 메뉴가 새로 생깁니다.
3.  `주소` 컬럼에 조회를 원하는 주소를 입력합니다. (예: `충남 천안시 서북구 불당동 1329`, 지번주소 권장)
4.  **'건축물대장'** > **'조회 실행'** 메뉴를 클릭합니다.
5.  최초 실행 시 **권한 승인** 팝업이 뜹니다.
    *   `계속` -> 계정 선택 -> `고급` -> `...로 이동(안전하지 않음)` -> `허용`을 순서대로 클릭합니다.
6.  스크립트가 실행되며 자동으로 빈 칸들이 채워집니다.

## 5. 장점

*   **속도**: n8n을 거치지 않아 훨씬 빠릅니다.
*   **안정성**: 구글 서버에서 실행되므로 Vworld API IP 차단 문제에서 자유롭습니다.
*   **비용**: 완전 무료이며 별도의 서버(Railway 등)가 필요 없습니다.

## 6. 트러블슈팅 (자주 발생하는 에러)

### Q. "Vworld 검색 실패: 등록되지 않은 인증키입니다." 라고 나와요.
**A. API 키의 '서비스 URL' 설정 문제입니다.** (보내주신 스크린샷의 `www.test.com` 때문입니다)
1.  **Vworld 마이페이지 > 인증키 관리**로 가세요.
2.  사용하려는 키의 **[수정]** 버튼을 누르세요.
3.  **서비스 URL** 칸에 아래 주소들을 한 줄에 하나씩 추가해 주세요.
    ```
    script.google.com
    docs.google.com
    ```
    *   **주의**: '서비스유형'이 '기타'로 되어있으면 URL 입력이 막힐 수 있습니다. 이 경우 **'웹사이트'**로 변경하고 위 주소를 입력하세요.
4.  저장 후 약 1분 뒤에 다시 시도해 보세요.

**Q. 운영키를 신청해야 하나요?**
A. **아니요, 개발키로도 충분합니다.** 개발키는 하루 4만 건까지 가능한데, 보내주신 사진의 4건은 방금 실패한 시도들이 기록된 것입니다. 즉, 요청은 도달했으나 URL이 달라서 거절된 것입니다.

### Q. "주소 검색 실패" 또는 "검색 결과가 없습니다"
**A. 입력한 주소가 Vworld에서 인식되지 않는 경우입니다.**
*   도로명 주소 대신 **지번 주소**(예: 불당동 1329)로 입력하면 성공률이 높습니다.
*   오타가 없는지 확인해 보세요.

### Q. "건축물대장 데이터 없음 (API 응답 확인 필요)" 또는 "응답이 JSON이 아닙니다"
**A. 공공데이터포털 API 요청 오류입니다.**
*   셀에 적힌 에러 메시지를 자세히 읽어보세요.
*   `SERVICE KEY IS NOT REGISTERED ERROR`: 키가 아직 승인되지 않았거나(1시간 소요), 잘못된 키입니다.
*   `LIMITED NUMBER OF SERVICE REQUESTS EXCEEDS`: 일일 트래픽 초과입니다.
*   `HTTP 500` / `Gateway`: 서버 점검 중이거나 일시적 오류입니다.
