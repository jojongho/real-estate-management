# AppSheet 고객 정보 입력 폼 추가 가이드

**목적**: 이미 완성된 매물 등록 폼에 고객 연락처 및 기타 고객 정보 입력 필드 추가

---

## 🎯 현재 상태 및 목표

### ✅ 이미 구현 완료된 기능
- 단지명 선택 → 동 드롭다운 필터링
- 동 선택 → 호 드롭다운 필터링  
- 호 선택 → 타입 드롭다운 필터링
- 타입 선택 → 분양가, 발코니값 자동 로딩
- 타입 선택 → 해당 타입의 옵션 리스트 드롭다운

### 🎯 추가할 기능
- 고객 연락처 입력
- 고객 성함 입력
- 기타 고객 정보 (고객구분, 유입경로, 메모 등)

---

## 📋 작업 1: 고객 정보 필드 추가하기

### 방법 A: "Is Part Of" 방식 (추천) ⭐⭐⭐⭐⭐

**개념**: 매물 등록 폼에서 고객 정보를 **동시에** 입력 가능하게 하는 방식

#### 1단계: 아파트매물 테이블에 Ref 필드 추가/확인
```
□ AppSheet → Data → Tables → 아파트매물 선택
□ Columns 탭
□ "고객" 컬럼이 있는지 확인
```

**없으면 새로 추가**:
```
□ + Add column 클릭
□ Column name: 고객
□ Type: Ref 선택
□ Type Details:
   Source table: 고객DB
   Label column: 고객성함 (또는 고객명)
□ Save
```

#### 2단계: "Is Part Of" 설정
```
□ Data → Columns → 아파트매물 → 고객 필드 클릭
□ 아래로 스크롤하여 "Relationships" 섹션 찾기
□ "Is Part Of?" 옵션 체크 ✅

□ Display name: "의뢰 고객" 또는 "매물 소유자"
```

#### 3단계: 폼에서 보이기 설정
```
□ UX → Views → Form (아파트매물 등록용)
□ 필드 목록에서 "고객" 필드 찾기
□ 표시 위치 조정 (매물 기본정보 아래에 배치 권장)
```

---

### 방법 B: 중첩 폼 방식 (더 복잡하지만 완전 분리)

고객 정보를 별도 폼으로 완전히 분리하고 싶다면:

#### 1단계: 고객DB 폼 생성
```
□ UX → Views → + Add View 클릭
□ View type: Form 선택
□ Detail table: 고객DB
□ Form name: "고객등록"
```

#### 2단계: 매물 등록 폼에서 고객 폼 호출
```
□ 아파트매물 Form 뷰 편집
□ Actions 탭
□ 사용자 액션 추가 (예: "+ 새 고객 추가" 버튼)
□ LINKTOFORM("고객등록")
```

---

## 🎯 추가할 고객 정보 필드 목록

현재 **등록검색** 시트의 고객 정보 섹션 기준:

### 필수 고객 정보
| 필드명 | AppSheet Type | 설명 | 현재 구글시트 |
|--------|---------------|------|---------------|
| **고객** | Ref → 고객DB | 매물 소유자 연결 | Row 29 필드 |
| **고객구분** | Enum | 매도인/손님 | Row 29 |
| **연락처** | Phone | 전화번호 | Row 31 |
| **비상연락처** | Phone | 비상 전화번호 | Row 32 |
| **고객성함** | Name | 이름 | Row 34 |
| **유입경로** | Enum | 광고/소개 등 | Row 30 |
| **메모** | LongText | 고객 관련 메모 | Row 33 |
| **고객주소** | Address | 주소 | Row 35 |

---

## 📝 단계별 구현 가이드

### Phase 1: 필수 필드만 추가 (빠른 구현)

**작업 시간**: 10-15분

#### 1단계: 고객DB 테이블 확인
```
□ AppSheet → Data → Tables → 고객DB
□ 다음 컬럼들이 있는지 확인:
   - 고객ID (Key)
   - 고객성함 (Label)
   - 연락처
   - 고객구분
```

**없으면 추가**:
```
□ + Add column
□ 컬럼명/타입:
   - 연락처: Phone
   - 고객구분: Enum (매도인/손님/임차인/임대인 등)
   - 메모: LongText
   - 고객주소: Address
```

#### 2단계: 아파트매물에 고객 연결
```
□ Data → Tables → 아파트매물 → Columns
□ "고객" Ref 필드 확인 또는 추가
□ Is Part Of? → ON
```

#### 3단계: 폼 배치
```
□ UX → Views → Form (아파트매물)
□ 왼쪽 필드 목록에서 "고객" 필드 드래그하여 위치 조정

권장 배치 순서:
1. 단지명
2. 동
3. 호
4. 타입
5. 분양가 / 발코니
6. 옵션 선택
7. ──── (구분선) ────
8. 고객 (Ref)
9. 거래유형
10. 거래상태
11. 기타 매물 정보
```

---

### Phase 2: 가상 컬럼 추가 (자동 표시용)

매물 폼에서 고객 정보를 자동으로 표시하고 싶다면:

#### Virtual Column 생성
```
□ Data → Tables → 아파트매물 → Columns → + Add column
□ Column name: 고객연락처
□ Type: Virtual
□ App formula: [고객].[연락처]

□ Column name: 고객구분_표시
□ Type: Virtual
□ App formula: [고객].[고객구분]
```

이제 매물을 선택하면 고객 정보가 자동으로 표시됩니다.

---

## 🎨 폼 UI 최적화

### 섹션 구분 사용

복잡한 폼을 읽기 쉽게 만들기:

```
□ UX → Views → Form → 편집 모드
□ + Add section 클릭
□ Section name: "🏠 매물 정보"
□ 매물 관련 필드들 드래그하여 이 섹션으로 이동

□ + Add section
□ Section name: "👤 고객 정보"
□ 고객 관련 필드들 드래그하여 이동

□ + Add section
□ Section name: "💰 가격 정보"
□ 분양가, 발코니, 옵션 등 드래그 이동
```

### 필수 필드 표시

```
□ 각 필드를 클릭
□ "Required" 옵션 체크
□ ※ 표시가 자동으로 나타남
```

### 기본값 설정

**고객구분**:
```
□ Data → Columns → 고객DB → 고객구분
□ Initial Value 섹션
□ Value: "손님" (기본값)
```

**유입경로**:
```
□ Initial value: "온라인광고" (예시)
```

---

## ✅ 검증 체크리스트

### Phase 1 완료 기준
```
✅ "고객" Ref 필드가 아파트매물 테이블에 존재
✅ Is Part Of? 옵션 활성화
✅ 폼에서 "고객" 필드가 표시됨
✅ 고객 선택 시 드롭다운에 고객DB 목록 표시
✅ "+ 새 고객 추가" 버튼 클릭 시 고객 등록 폼 열림
```

### Phase 2 완료 기준
```
✅ 고객 연락처 Virtual Column 생성
✅ 고객 선택 시 연락처 자동 표시
✅ 고객 정보 섹션 구분됨
✅ 필수 필드 표시 (※)
```

### 전체 테스트 시나리오
```
1️⃣ 아파트매물 Form 열기
2️⃣ 단지명 선택 → 동/호/타입 선택 → 분양가 확인 ✅
3️⃣ 옵션 리스트 확인 ✅
4️⃣ "고객" 필드 클릭
5️⃣ 기존 고객 선택 또는 "+ 새 고객 추가" ✅
6️⃣ 새 고객 정보 입력 (성함, 연락처, 고객구분)
7️⃣ 저장
8️⃣ 매물 정보와 고객 정보가 함께 저장되는지 확인 ✅
9️⃣ 고객DB에서 해당 고객이 등록되었는지 확인 ✅
🔟 고객 상세화면에서 "Related 아파트매물" 목록 확인 ✅
```

---

## 🚨 트러블슈팅

### 문제 1: "고객" 필드가 안 보임
**해결**:
```
□ UX → Views → Form → 필드 목록 체크
□ "고객" 필드가 숨김(Show = OFF) 처리되어 있는지 확인
□ Show를 ON으로 변경
```

### 문제 2: "새 고객 추가" 버튼이 없음
**해결**:
```
□ Data → Columns → 아파트매물 → 고객
□ "Allow add from form" 옵션 체크 ✅
□ 또는 "Is Part Of?" 옵션 다시 확인
```

### 문제 3: 고객 정보가 저장 안 됨
**해결**:
```
□ 권한 설정 확인:
   UX → Security → Roles
   고객을 추가할 권한이 있는지 확인

□ 데이터베이스 구조 확인:
   고객DB 테이블의 Key 컬럼 설정 확인
   고객ID가 Key로 설정되어 있는지 확인
```

### 문제 4: Virtual Column이 비어있음
**해결**:
```
□ App formula 다시 확인:
   [고객].[연락처] 형식이 맞는지
   컬럼명이 정확한지 (대소문자, 띄어쓰기)

□ 테스트:
   고객DB에서 직접 연락처 값이 있는지 확인
```

---

## 🎯 마무리 및 다음 단계

### 즉시 적용 가능한 작업
```
□ 고객 Ref 필드 추가 (Is Part Of 활성화)
□ 폼에 고객 섹션 배치
□ 필수 필드만 표시 (연락처, 고객구분)
```

### 추가 개선 사항 (선택)
```
□ Virtual Column (고객정보 자동 표시)
□ 섹션 구분 (매물/고객/가격)
□ Automation (고객 등록 시 알림)
□ 고객 중복 검사 (같은 연락처)
```

---

## 📞 참고 자료

- **기존 구현**: AppSheet_드롭다운_구현_체크리스트.md
- **참조 설정**: 매물관리 앱시트 만들기 내용.md (7184-7229줄)
- **통합 구조**: 문서 참고

---

**작성일**: 2025-01-XX
**버전**: 1.0
**상태**: ✅ 현재 AppSheet 환경에 바로 적용 가능

